<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:c="http://java.sun.com/jsp/jstl/core">
<ui:include src="/include/IncludeHeader.xhtml"></ui:include>

<h:head>
	<script
		src="http://maps.google.com/maps/api/js?key=AIzaSyDXM9lmEguvVPQD50Jx6Lxl2cVeevCV50Y"
		type="text/javascript"></script>
</h:head>
<body>
	<!-- Esta parte es delicada la lista se llena en un bean "UserBean" -->
	<ui:include src="/include/HiAndByeTrans.xhtml"></ui:include>
	<ui:include src="/include/IncludeBanner.html"></ui:include>
	<ui:include src="/include/IncludeTransMenu.xhtml"></ui:include>


	<p:panel id="panel" header="Panel de edición de localizacion"
		styleClass="blockUser">
		<f:facet name="header">
							Datos generales de la localizacion
						</f:facet>
		<h:form id="LocationId" styleClass="distributerSelector">
			<p:inputText type="hidden" id="test" name="hidden1"
				value="#{LocationBean.center}">
				<p:ajax event="valueChange" />
			</p:inputText>
			<h:panelGrid id="panelLocation" columns="2" cellpadding="5">
				<h:outputText value="Platforma:" />
				<p:selectOneButton value="#{LocationBean.option}">
					<f:selectItem itemLabel="Direccion" itemValue="1" />
					<f:selectItem itemLabel="Coordenas" itemValue="2" />
					<f:selectItem itemLabel="Mapa" itemValue="3" />
					<p:ajax event="change" update="panelLocationDetail"
						listener="#{LocationBean.locationEntryListenerMethod}" />
				</p:selectOneButton>

				<p:spacer />

			</h:panelGrid>

			<h:panelGrid id="panelLocationDetail" columns="1" cellpadding="5">
				<p:spacer />


				<h:outputText id="display2" value="#{LocationBean.center}"
					rendered="#{LocationBean.option == '1'}" style="font-weight: bold" />


				<h:panelGrid id="panel1" columns="3" cellpadding="5">
					<p:outputLabel value="Latitud:" for="gpslat"
						rendered="#{LocationBean.option == '2'}" />
					<p:inputText id="gpslat" value="#{LocationBean.location.latitude}"
						required="#{LocationBean.editDetail}"
						readonly="#{!(LocationBean.editDetail)}"
						rendered="#{LocationBean.option == '2'}"
						validatorMessage="Solo coordenadas papá">
						<p:ajax event="keyup" update="gpslatmsg" />
						<f:validateRegex pattern="(^-?[0-9]\d*(\.\d+)?$)" />
					</p:inputText>
					<p:message id="gpslatmsg" for="gpslat" display="text,tooltip" />

					<p:outputLabel value="Longitud:" for="gpslon"
						rendered="#{LocationBean.option == '2'}" />
					<p:inputText id="gpslon" value="#{LocationBean.location.longitude}"
						required="#{LocationBean.editDetail}"
						readonly="#{!(LocationBean.editDetail)}"
						rendered="#{LocationBean.option == '2'}"
						validatorMessage="Solo coordenadas papá">
						<p:ajax event="keyup" update="gpslonmsg" />
						<f:validateRegex pattern="^-?[0-9]\d*(\.\d+)?$" />
					</p:inputText>
					<p:message id="gpslonmsg" for="gpslon" display="text,tooltip" />
				</h:panelGrid>

				<p:dialog header="Mapa" widgetVar="dlg" modal="true"
					resizable="false" id="dialogo3" height="400" width="80%"
					closeOnEscape="true">
					<p:gmap center="#{LocationBean.center}" zoom="13" type="HYBRID"
						id="mapitaNew" style="width:100%;height:400px"
						rendered="#{LocationBean.option == '3'}"
						model="#{LocationBean.emptyModel}">
						<p:ajax event="pointSelect" listener="#{LocationBean.addMarkerListinerMethod}"/>
						</p:gmap>
				</p:dialog>
			</h:panelGrid>
			<!-- PANEL DE BOTONES  -->
			<h:panelGrid id="buttonPanel" columns="3" cellpadding="5">

				<p:commandButton ajax="false" value="#{msg.change}"
					id="buttonChange" action="#{LocationBean.actionChangeUser}"
					validateClient="true"
					rendered="#{!LocationBean.showDetailNew and LocationBean.showDetail}"
					update="error,userEditPanel" />
				<p:commandButton ajax="false"
					value="#{LocationBean.userEnabled ? msg.deactivate:msg.reactivate}"
					id="buttonDelete" action="#{LocationBean.actionDeleteUser}"
					validateClient="true"
					rendered="#{!LocationBean.showDetailNew and LocationBean.showDetail and !LocationBean.editDetail}"
					process="@none" />
				<p:commandButton ajax="false" value="#{msg.actionAddUser}"
					id="buttonAdd" action="#{LocationBean.actionAddUser}"
					validateClient="true"
					rendered="#{LocationBean.showDetailNew and LocationBean.showDetail}"
					update="error" />
				<p:commandButton ajax="false" value="#{msg.cancel}" immediate="true"
					id="cancel" process="@none" action="#{LocationBean.actionExit}" />
			</h:panelGrid>
		</h:form>
	</p:panel>
	<ui:include src="/include/IncludeFooter.html"></ui:include>
	<script>
		var currentMarker = null;

		function handlePointClick(event) {
			if (currentMarker === null) {
				document.getElementById('LocationId:gpslat').value = event.latLng.lat();
				document.getElementById('LocationId:gpslon').value = event.latLng.lng();

				currentMarker = new google.maps.Marker({
					position : new google.maps.LatLng(event.latLng.lat(),
							event.latLng.lng())
				});

				PF('map').addOverlay(currentMarker);

				PF('dlg').show();
			}
		}

		function markerAddComplete() {
			var title = document.getElementById('title');
			currentMarker.setTitle(title.value);
			title.value = "";

			currentMarker = null;
			PF('dlg').hide();
		}

		function cancel() {
			PF('dlg').hide();
			currentMarker.setMap(null);
			currentMarker = null;

			return false;
		}
		function ip_callback(o) {
			var latlong = "";
			latlong = latlong.concat(o.latitude, ",", o.longitude)
			document.getElementById("LocationId:test").value = latlong;
		}
	</script>
	<script src="http://freegeoip.net/json/?callback=ip_callback"></script>
</body>
</html>